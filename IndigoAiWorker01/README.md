# IndigoAiWorker01 - AI-Powered Worker

Micro-servizio .NET 8 con capacità AI per generazione codice, refactoring, analisi e integrazione con Cursor.

## Descrizione

IndigoAiWorker01 è un Worker AI avanzato che:
- Funziona come un normale Worker (compatibile con Orchestrator)
- Implementa funzionalità AI per sviluppo software
- Si integra con Cursor attraverso file system (diretto e indiretto)

## Funzionalità AI

### Task Supportati

1. **generate-code**: Genera codice da prompt testuale
2. **refactor-code**: Refactorizza codice esistente
3. **explain-code**: Spiega e documenta codice
4. **create-component**: Crea componenti da specifica
5. **fix-snippet**: Corregge snippet di codice
6. **cursor-prompt**: Scrive prompt strutturati per Cursor

## Endpoint

### GET /health
Health check del worker.

**Risposta:**
```json
{
  "Status": "OK",
  "Timestamp": "2026-01-01T10:00:00.000Z"
}
```

### GET /status
Stato dettagliato del worker AI.

**Risposta:**
```json
{
  "Agent": "IndigoAiWorker01",
  "Type": "AI-Worker",
  "Uptime": "01:23:45",
  "Version": "1.0.0-AI",
  "LastTask": "generate-code",
  "Capabilities": [
    "generate-code",
    "refactor-code",
    "explain-code",
    "create-component",
    "fix-snippet",
    "cursor-prompt"
  ]
}
```

### POST /execute
Esegue un task AI.

**Request:**
```json
{
  "Task": "generate-code",
  "Payload": "Crea una classe User con proprietà Id, Name, Email"
}
```

**Response:**
```json
{
  "Success": true,
  "Message": "AI Task executed",
  "Result": "// Codice generato...",
  "ExecutedTask": "generate-code",
  "Timestamp": "2026-01-01T10:00:00.000Z",
  "CursorFileWritten": true,
  "CursorFilePath": "C:\\...\\CursorBridge\\request-generate-code-2026-01-01-100000.md"
}
```

### GET /cursor/bridge-files
Lista file nella CursorBridge.

**Risposta:**
```json
{
  "Success": true,
  "Count": 5,
  "Files": [
    "request-generate-code-2026-01-01-100000.md",
    "request-refactor-code-2026-01-01-100100.md"
  ]
}
```

### POST /cursor/cleanup
Pulisce file vecchi (> 7 giorni) dalla CursorBridge.

**Risposta:**
```json
{
  "Success": true,
  "Message": "Cleanup completato: 3 file eliminati",
  "DeletedCount": 3
}
```

## Integrazione con Cursor

### Modalità 1: Indiretta (CursorBridge)

Il worker scrive file markdown nella cartella `./CursorBridge/`:

```
IndigoAiWorker01/
├── CursorBridge/
│   ├── request-generate-code-2026-01-01-120000.md
│   ├── request-refactor-code-2026-01-01-120100.md
│   └── request-explain-code-2026-01-01-120200.md
└── ...
```

**Contenuto file esempio:**
```markdown
# AI Request from IndigoAiWorker01

**Timestamp**: 2026-01-01 12:00:00 UTC
**Task**: generate-code
**Status**: Pending

## Request Details

Crea una classe User con proprietà Id, Name, Email

## Instructions for Cursor

1. Analizza il payload
2. Implementa la soluzione richiesta
3. Verifica che il codice sia corretto
4. Aggiorna questo file con lo stato: Completed

## Expected Output

- File modificati: [list]
- Nuovi file creati: [list]
- Test eseguiti: [list]

---
*Generated by IndigoAiWorker01 AI Engine v1.0*
```

### Modalità 2: Diretta (.cursor/ai-requests)

Il worker scrive direttamente nella cartella `.cursor/ai-requests/` del workspace, dove Cursor può leggerli automaticamente.

```
workspace-root/
├── .cursor/
│   └── ai-requests/
│       ├── generate-code-2026-01-01-120000.md
│       ├── refactor-code-2026-01-01-120100.md
│       └── ...
└── ...
```

## Esempi di Utilizzo

### Esempio 1: Genera Codice

**Request:**
```bash
curl -X POST http://localhost:5005/execute \
  -H "Content-Type: application/json" \
  -d '{
    "Task": "generate-code",
    "Payload": "Crea una classe Product con Id, Name, Price e metodo ApplyDiscount"
  }'
```

**Response:**
```json
{
  "Success": true,
  "Message": "AI Task executed",
  "Result": "// Codice generato da IndigoAiWorker01\n// Prompt: Crea una classe Product...\n\npublic class GeneratedClass\n{\n    public string Property { get; set; }\n    ...\n}",
  "ExecutedTask": "generate-code",
  "Timestamp": "2026-01-01T12:00:00.000Z",
  "CursorFileWritten": true,
  "CursorFilePath": "C:\\...\\CursorBridge\\request-generate-code-2026-01-01-120000.md"
}
```

### Esempio 2: Refactorizza Codice

**Request:**
```bash
curl -X POST http://localhost:5005/execute \
  -H "Content-Type: application/json" \
  -d '{
    "Task": "refactor-code",
    "Payload": "public void Process() { var x = 10; if (x > 5) { Console.WriteLine(x); } }"
  }'
```

**Response:**
Il worker restituisce il codice refactorato e scrive un file per Cursor con suggerimenti.

### Esempio 3: Spiega Codice

**Request:**
```bash
curl -X POST http://localhost:5005/execute \
  -H "Content-Type: application/json" \
  -d '{
    "Task": "explain-code",
    "Payload": "public async Task<List<User>> GetUsersAsync() { return await _db.Users.ToListAsync(); }"
  }'
```

**Response:**
Il worker genera una spiegazione dettagliata del codice in formato markdown.

### Esempio 4: Crea Componente

**Request:**
```bash
curl -X POST http://localhost:5005/execute \
  -H "Content-Type: application/json" \
  -d '{
    "Task": "create-component",
    "Payload": "Logger middleware per ASP.NET Core che logga Request/Response"
  }'
```

**Response:**
Il worker genera un componente completo pronto all'uso.

### Esempio 5: Cursor Prompt Diretto

**Request:**
```bash
curl -X POST http://localhost:5005/execute \
  -H "Content-Type: application/json" \
  -d '{
    "Task": "cursor-prompt",
    "Payload": "Crea una nuova pagina WPF per visualizzare statistiche cluster con grafici"
  }'
```

**Response:**
Il worker scrive un prompt strutturato per Cursor senza generare codice.

## Integrazione con Orchestrator

IndigoAiWorker01 è compatibile con l'Orchestrator. Per aggiungerlo al load balancing:

**Modifica Agent.Orchestrator/Program.cs:**
```csharp
var workers = new[] { 
    "http://localhost:5002",  // Worker01
    "http://localhost:5003",  // Worker02
    "http://localhost:5005"   // IndigoAiWorker01
};
```

Poi, dall'Orchestrator:
```bash
curl -X POST http://localhost:5001/dispatch \
  -H "Content-Type: application/json" \
  -d '{
    "Task": "generate-code",
    "Payload": "Crea una classe Invoice"
  }'
```

L'Orchestrator distribuirà il task AI al worker appropriato.

## Architettura

```
IndigoAiWorker01/
├── Program.cs           → Endpoint e dispatcher
├── WorkerState.cs       → Stato interno
├── AiEngine.cs          → Motore AI (stub per LLM)
├── CursorBridge.cs      → Integrazione file system
├── CursorBridge/        → File per Cursor (creata al runtime)
└── README.md            → Documentazione
```

### Componenti

1. **AiEngine**: Modulo AI con metodi stub pronti per integrazione con LLM reali (GPT, Claude, ecc.)
2. **CursorBridge**: Gestisce scrittura file per comunicazione con Cursor
3. **WorkerState**: Mantiene stato worker (uptime, last task)
4. **Dispatcher**: Switch case per instradare task AI ai metodi corretti

## Utilizzo

### Avvio Worker
```bash
cd IndigoAiWorker01
dotnet run
```

Il worker sarà disponibile su `http://localhost:5005`

### Test Rapido
```bash
# Health check
curl http://localhost:5005/health

# Status
curl http://localhost:5005/status

# Esegui task AI
curl -X POST http://localhost:5005/execute \
  -H "Content-Type: application/json" \
  -d '{"Task":"generate-code","Payload":"Crea classe User"}'

# Lista file CursorBridge
curl http://localhost:5005/cursor/bridge-files

# Cleanup file vecchi
curl -X POST http://localhost:5005/cursor/cleanup
```

## Configurazione

- **Porta**: 5005
- **Versione**: 1.0.0-AI
- **Target Framework**: .NET 8.0
- **JSON**: PascalCase
- **Timeout**: N/A (task AI veloci < 1s per stub)

## Future Enhancements

1. **Integrazione LLM reale**:
   - OpenAI GPT-4
   - Anthropic Claude
   - Azure OpenAI

2. **Context Management**:
   - Carica file progetto per context
   - Analizza struttura codebase
   - Mantieni history conversazioni

3. **Advanced AI Features**:
   - Code review automatico
   - Test generation
   - Bug detection
   - Performance optimization suggestions

4. **Cursor Integration**:
   - Websocket per comunicazione real-time
   - API diretta (se Cursor espone)
   - Plugin Cursor dedicato

5. **Persistent Storage**:
   - Database per history task
   - Cache risultati AI
   - Metriche utilizzo

## Troubleshooting

**Problema: CursorBridge non crea file**
- Verifica permessi scrittura
- Controlla log: `dotnet run` mostra errori
- Path: `IndigoAiWorker01/CursorBridge/`

**Problema: .cursor/ai-requests non raggiungibile**
- Il worker usa fallback su CursorBridge locale
- Verifica struttura workspace
- Controlla log warning

**Problema: Task non supportato**
- Verifica nome task (case-insensitive)
- Task disponibili: `generate-code`, `refactor-code`, `explain-code`, `create-component`, `fix-snippet`, `cursor-prompt`

## Note

- I metodi AI sono attualmente **stub** (simulati)
- Pronti per integrazione con LLM reali
- Architettura modulare per facile estensione
- JSON sempre PascalCase per coerenza cluster

---

**IndigoAiWorker01** - AI-Powered Worker for IndigoLab Cluster v1.0
